{{#> head title="Project"}}
{{/head}}
<body>
  <section>  
    <header>
      <h1>{{default line.name 'New spending'}}</h1>
      <span>{{project.name}}</span>
    </header>
    <nav>
      <a href="..">Back</a>
    </nav>
    <form class="grid" hx-post="/projects/{{project.id}}/lines" x-data="{ balanced: true }" hx-target="#error">
      <input type="hidden" name="project_id" value="{{project.id}}"/>
      <input type="hidden" name="id" value="{{line.id}}"/>
      <label class="form-control">
        <span class="label label-text">Title</span>
        <input name="name" class="input input-bordered" autofocus="" required="" value="{{line.name}}" />
      </label>
      <label class="form-control">
        <span class="label label-text">Amount</span>
        <div class="flex gap-2">
          <input name="amount"class="input input-bordered grow" inputmode="decimal" pattern="[0-9.\-]*" type="text" required=""  />
          <select name="currency" class="select select-bordered" value="{{line.currency}}"> 
            <option>EUR</option>
            <option>SGD</option>
            <option>USD</option>
          </select>
        </div>
      </label>
      <label class="form-control">
        <span class="label label-text">Date</span>
        <input type="datetime-local" name="created_at" class="input input-bordered" value="{{line.created_at}}" />
      </label>
      <div class="flex gap-2">
        <label class="form-control grow">
          <span class="label label-text">Paid by</span>
          <select name="paid" class="select select-bordered" value="{{line.paid}}">
            {{#each project.participants}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
          </select>
        </label>
        <label class="flex flex-col items-center">
          <span class="label label-text">Balanced?</span>
          <input type="checkbox" class="toggle toggle-primary mt-3" x-model="balanced" name="balanced" />
        </label>
      </div>
      <ul class="grid gap-4 mt-4">
        {{#each split}}
        {{#if specific}}
        <li class="flex items-center gap-4">
          ???
        </li>
        {{else}}
        <li class="flex items-center gap-4">
          <input id="{{this.participant}}" type="checkbox" class="checkbox" x-show="balanced"/>
          <label for="'part'+ index" class="flex items-center gap-4 whitespace-nowrap">{{this.participant}}</label>
          <input name="split[{{@index}}][participant]" value={{this.participant}} type="hidden"/>
          <input name="split[{{@index}}][amount]" :disabled="balanced" value="{{this.amount}}" class="input input-bordered w-full" inputmode="numeric" pattern="[0-9.\-]*" type="text"/>
          <span>{{../project.currency}}</span>
        </li>
        {{/if}}
       {{/each}}
      </ul>
      <div class="my-8 flex justify-start gap-8 flex-row-reverse">
        <button class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-warning" hx-confirm="Are you ssssuuuure?" hx-delete="/projects/{{project.id}}/lines/{{line.id}}">Delete</button>
      </div>
      <span id="error" class="text-red-400 text-right"></span>
    </form>
  </section>
</body>
